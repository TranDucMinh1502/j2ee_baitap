<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <!--
    ================================================
    HUTECH BOOKSTORE - UI COMPONENTS LIBRARY
    Reusable Thymeleaf Fragments
    Version: 2.0
    ================================================
-->

  <body>
    <!-- ==================== CARDS ==================== -->

    <!-- Book Card for Grid View -->
    <div th:fragment="book-card(book)" class="hutech-book-card hutech-card">
      <a th:href="@{/books/{id}(id=${book.id})}" class="text-decoration-none">
        <img
          th:src="${book.imageUrl != null ? book.imageUrl : '/images/book-placeholder.jpg'}"
          th:alt="${book.title}"
          class="hutech-book-image"
          onerror="this.src = '/images/book-placeholder.jpg'"
        />

        <div class="hutech-card-body">
          <h5 class="hutech-book-title" th:text="${book.title}">Tên sách</h5>
          <p class="hutech-book-author" th:text="${book.author}">Tác giả</p>

          <div class="d-flex justify-content-between align-items-center mb-3">
            <div
              class="hutech-book-price"
              th:text="${#numbers.formatDecimal(book.price, 0, 'COMMA', 0, 'POINT')} + ' ₫'"
            >
              100,000 ₫
            </div>
            <div th:if="${book.stockQuantity != null}">
              <span
                th:if="${book.stockQuantity > 0}"
                class="hutech-badge hutech-badge-success"
              >
                <i class="bi bi-check-circle"></i> Còn hàng
              </span>
              <span
                th:unless="${book.stockQuantity > 0}"
                class="hutech-badge hutech-badge-danger"
              >
                <i class="bi bi-x-circle"></i> Hết hàng
              </span>
            </div>
          </div>

          <div class="d-flex gap-2">
            <a
              th:href="@{/books/{id}(id=${book.id})}"
              class="hutech-btn hutech-btn-outline-primary hutech-btn-sm flex-grow-1"
            >
              <i class="bi bi-eye"></i> Xem
            </a>
            <form th:action="@{/cart/add}" method="post" class="flex-grow-1">
              <input type="hidden" name="bookId" th:value="${book.id}" />
              <button
                type="submit"
                class="hutech-btn hutech-btn-primary hutech-btn-sm w-100"
                th:disabled="${book.stockQuantity == null or book.stockQuantity <= 0}"
              >
                <i class="bi bi-cart-plus"></i> Thêm
              </button>
            </form>
          </div>
        </div>
      </a>
    </div>

    <!-- Book Card for List View -->
    <div th:fragment="book-card-list(book)" class="hutech-card mb-3">
      <div class="hutech-card-body">
        <div class="row align-items-center">
          <div class="col-md-2 col-sm-3">
            <img
              th:src="${book.imageUrl != null ? book.imageUrl : '/images/book-placeholder.jpg'}"
              th:alt="${book.title}"
              class="img-fluid rounded"
              style="max-height: 150px; object-fit: cover"
            />
          </div>
          <div class="col-md-7 col-sm-6">
            <h5 class="fw-bold mb-2" th:text="${book.title}">Tên sách</h5>
            <p class="hutech-text-muted mb-2">
              <i class="bi bi-person me-1"></i>
              <span th:text="${book.author}">Tác giả</span>
            </p>
            <p class="hutech-text-muted mb-2" th:if="${book.category != null}">
              <i class="bi bi-tag me-1"></i>
              <span th:text="${book.category.name}">Danh mục</span>
            </p>
            <div>
              <span
                th:if="${book.stockQuantity != null and book.stockQuantity > 0}"
                class="hutech-badge hutech-badge-success"
              >
                Còn <span th:text="${book.stockQuantity}">0</span> quyển
              </span>
              <span
                th:if="${book.stockQuantity != null and book.stockQuantity <= 0}"
                class="hutech-badge hutech-badge-danger"
              >
                Hết hàng
              </span>
            </div>
          </div>
          <div class="col-md-3 col-sm-3 text-end">
            <div
              class="hutech-book-price mb-3"
              th:text="${#numbers.formatDecimal(book.price, 0, 'COMMA', 0, 'POINT')} + ' ₫'"
            >
              100,000 ₫
            </div>
            <div class="d-flex flex-column gap-2">
              <a
                th:href="@{/books/{id}(id=${book.id})}"
                class="hutech-btn hutech-btn-outline-primary hutech-btn-sm"
              >
                <i class="bi bi-eye"></i> Chi tiết
              </a>
              <form th:action="@{/cart/add}" method="post">
                <input type="hidden" name="bookId" th:value="${book.id}" />
                <button
                  type="submit"
                  class="hutech-btn hutech-btn-primary hutech-btn-sm w-100"
                  th:disabled="${book.stockQuantity == null or book.stockQuantity <= 0}"
                >
                  <i class="bi bi-cart-plus"></i> Thêm giỏ
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Category Card -->
    <div
      th:fragment="category-card(category)"
      class="hutech-card text-center h-100"
    >
      <div class="hutech-card-body">
        <div class="mb-3">
          <i class="bi bi-folder2-open display-3 hutech-text-primary"></i>
        </div>
        <h5 class="fw-bold mb-2" th:text="${category.name}">Danh mục</h5>
        <p
          class="hutech-text-muted small mb-3"
          th:text="${category.description}"
        >
          Mô tả danh mục
        </p>
        <a
          th:href="@{/books/list(categoryId=${category.id})}"
          class="hutech-btn hutech-btn-outline-primary hutech-btn-sm"
        >
          Xem sách <i class="bi bi-arrow-right ms-1"></i>
        </a>
      </div>
    </div>

    <!-- ==================== FORMS ==================== -->

    <!-- Form Input Group -->
    <div
      th:fragment="form-input(id, label, type, name, value, placeholder, required, error)"
    >
      <div class="hutech-form-group">
        <label
          th:for="${id}"
          class="hutech-form-label"
          th:classappend="${required ? 'hutech-form-label-required' : ''}"
          th:text="${label}"
        >
          Label
        </label>
        <input
          th:type="${type}"
          th:id="${id}"
          th:name="${name}"
          th:value="${value}"
          th:placeholder="${placeholder}"
          th:required="${required}"
          class="hutech-form-control"
          th:classappend="${error != null ? 'is-invalid' : ''}"
        />
        <div
          th:if="${error != null}"
          class="hutech-form-error"
          th:text="${error}"
        >
          Error message
        </div>
      </div>
    </div>

    <!-- Form Textarea -->
    <div
      th:fragment="form-textarea(id, label, name, value, placeholder, rows, required, error)"
    >
      <div class="hutech-form-group">
        <label
          th:for="${id}"
          class="hutech-form-label"
          th:classappend="${required ? 'hutech-form-label-required' : ''}"
          th:text="${label}"
        >
          Label
        </label>
        <textarea
          th:id="${id}"
          th:name="${name}"
          th:placeholder="${placeholder}"
          th:required="${required}"
          th:rows="${rows != null ? rows : 3}"
          class="hutech-form-control"
          th:classappend="${error != null ? 'is-invalid' : ''}"
          th:text="${value}"
        >
        </textarea>
        <div
          th:if="${error != null}"
          class="hutech-form-error"
          th:text="${error}"
        >
          Error message
        </div>
      </div>
    </div>

    <!-- Form Select -->
    <div
      th:fragment="form-select(id, label, name, options, selectedValue, required, error)"
    >
      <div class="hutech-form-group">
        <label
          th:for="${id}"
          class="hutech-form-label"
          th:classappend="${required ? 'hutech-form-label-required' : ''}"
          th:text="${label}"
        >
          Label
        </label>
        <select
          th:id="${id}"
          th:name="${name}"
          th:required="${required}"
          class="hutech-form-control"
          th:classappend="${error != null ? 'is-invalid' : ''}"
        >
          <option value="">-- Chọn --</option>
          <option
            th:each="option : ${options}"
            th:value="${option.id}"
            th:text="${option.name}"
            th:selected="${option.id == selectedValue}"
          >
            Option
          </option>
        </select>
        <div
          th:if="${error != null}"
          class="hutech-form-error"
          th:text="${error}"
        >
          Error message
        </div>
      </div>
    </div>

    <!-- ==================== BADGES ==================== -->

    <!-- Order Status Badge -->
    <span th:fragment="order-status-badge(status)">
      <span
        th:if="${status == 'PENDING'}"
        class="hutech-badge hutech-badge-warning"
      >
        <i class="bi bi-clock"></i> Chờ xác nhận
      </span>
      <span
        th:if="${status == 'CONFIRMED'}"
        class="hutech-badge hutech-badge-info"
      >
        <i class="bi bi-check-circle"></i> Đã xác nhận
      </span>
      <span
        th:if="${status == 'SHIPPING'}"
        class="hutech-badge hutech-badge-primary"
      >
        <i class="bi bi-truck"></i> Đang giao
      </span>
      <span
        th:if="${status == 'DELIVERED'}"
        class="hutech-badge hutech-badge-success"
      >
        <i class="bi bi-check-all"></i> Đã giao
      </span>
      <span
        th:if="${status == 'CANCELLED'}"
        class="hutech-badge hutech-badge-danger"
      >
        <i class="bi bi-x-circle"></i> Đã hủy
      </span>
    </span>

    <!-- Stock Status Badge -->
    <span th:fragment="stock-badge(quantity)">
      <span th:if="${quantity > 10}" class="hutech-badge hutech-badge-success">
        <i class="bi bi-check-circle"></i> Còn hàng
      </span>
      <span
        th:if="${quantity > 0 and quantity <= 10}"
        class="hutech-badge hutech-badge-warning"
      >
        <i class="bi bi-exclamation-triangle"></i> Sắp hết
      </span>
      <span th:if="${quantity <= 0}" class="hutech-badge hutech-badge-danger">
        <i class="bi bi-x-circle"></i> Hết hàng
      </span>
    </span>

    <!-- Role Badge -->
    <span th:fragment="role-badge(role)">
      <span
        th:if="${role == 'ROLE_ADMIN'}"
        class="hutech-badge hutech-badge-danger"
      >
        <i class="bi bi-shield-check"></i> Admin
      </span>
      <span
        th:if="${role == 'ROLE_USER'}"
        class="hutech-badge hutech-badge-primary"
      >
        <i class="bi bi-person"></i> User
      </span>
    </span>

    <!-- ==================== TABLES ==================== -->

    <!-- Table Header Actions -->
    <div th:fragment="table-header(title, searchPlaceholder, addUrl, addText)">
      <div
        class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3"
      >
        <div>
          <h4 class="fw-bold mb-0" th:text="${title}">Table Title</h4>
        </div>

        <div class="d-flex gap-3 align-items-center flex-wrap">
          <!-- Search -->
          <form method="get" class="mb-0" th:if="${searchPlaceholder != null}">
            <div class="hutech-input-group" style="min-width: 300px">
              <span class="hutech-input-group-text">
                <i class="bi bi-search"></i>
              </span>
              <input
                type="search"
                name="keyword"
                class="hutech-form-control"
                th:placeholder="${searchPlaceholder}"
                th:value="${keyword}"
              />
            </div>
          </form>

          <!-- Add Button -->
          <a
            th:if="${addUrl != null}"
            th:href="${addUrl}"
            class="hutech-btn hutech-btn-primary"
          >
            <i class="bi bi-plus-circle"></i>
            <span th:text="${addText != null ? addText : 'Thêm mới'}"
              >Thêm mới</span
            >
          </a>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div th:fragment="empty-state(icon, title, message, actionUrl, actionText)">
      <div class="text-center py-5">
        <i th:class="'bi ' + ${icon} + ' display-1 hutech-text-muted mb-3'"></i>
        <h4 class="fw-bold mb-2" th:text="${title}">Không có dữ liệu</h4>
        <p class="hutech-text-muted mb-4" th:text="${message}">
          Chưa có dữ liệu nào được thêm vào
        </p>
        <a
          th:if="${actionUrl != null}"
          th:href="${actionUrl}"
          class="hutech-btn hutech-btn-primary"
        >
          <i class="bi bi-plus-circle"></i>
          <span th:text="${actionText != null ? actionText : 'Thêm mới'}"
            >Thêm mới</span
          >
        </a>
      </div>
    </div>

    <!-- ==================== PAGINATION ==================== -->

    <!-- Enhanced Pagination -->
    <div th:fragment="pagination-enhanced(page)">
      <nav
        aria-label="Page navigation"
        th:if="${page != null and page.totalPages > 1}"
      >
        <div
          class="d-flex justify-content-between align-items-center flex-wrap gap-3"
        >
          <!-- Info -->
          <div class="hutech-text-muted small">
            Hiển thị
            <strong th:text="${page.numberOfElements}">0</strong>
            trong tổng số
            <strong th:text="${page.totalElements}">0</strong>
            kết quả
          </div>

          <!-- Pagination Links -->
          <ul class="hutech-pagination mb-0">
            <!-- Previous -->
            <li>
              <a
                class="hutech-pagination-link"
                th:classappend="${page.first ? 'disabled' : ''}"
                th:href="@{''(page=${page.number - 1}, keyword=${keyword}, size=${page.size})}"
              >
                <i class="bi bi-chevron-left"></i>
              </a>
            </li>

            <!-- Page Numbers -->
            <th:block
              th:with="totalPages=${page.totalPages}, currentPage=${page.number}"
            >
              <th:block th:if="${totalPages <= 7}">
                <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                  <a
                    class="hutech-pagination-link"
                    th:classappend="${i == currentPage ? 'active' : ''}"
                    th:href="@{''(page=${i}, keyword=${keyword}, size=${page.size})}"
                    th:text="${i + 1}"
                    >1</a
                  >
                </li>
              </th:block>

              <th:block th:if="${totalPages > 7}">
                <!-- First page -->
                <li>
                  <a
                    class="hutech-pagination-link"
                    th:classappend="${0 == currentPage ? 'active' : ''}"
                    th:href="@{''(page=0, keyword=${keyword}, size=${page.size})}"
                    >1</a
                  >
                </li>

                <!-- Ellipsis start -->
                <li th:if="${currentPage > 3}">
                  <span class="hutech-pagination-link disabled">...</span>
                </li>

                <!-- Middle pages -->
                <li
                  th:each="i : ${#numbers.sequence(currentPage - 2 < 1 ? 1 : currentPage - 2, 
                                                             currentPage + 2 >= totalPages - 1 ? totalPages - 2 : currentPage + 2)}"
                >
                  <a
                    class="hutech-pagination-link"
                    th:classappend="${i == currentPage ? 'active' : ''}"
                    th:href="@{''(page=${i}, keyword=${keyword}, size=${page.size})}"
                    th:text="${i + 1}"
                    >1</a
                  >
                </li>

                <!-- Ellipsis end -->
                <li th:if="${currentPage < totalPages - 4}">
                  <span class="hutech-pagination-link disabled">...</span>
                </li>

                <!-- Last page -->
                <li>
                  <a
                    class="hutech-pagination-link"
                    th:classappend="${totalPages - 1 == currentPage ? 'active' : ''}"
                    th:href="@{''(page=${totalPages - 1}, keyword=${keyword}, size=${page.size})}"
                    th:text="${totalPages}"
                    >1</a
                  >
                </li>
              </th:block>
            </th:block>

            <!-- Next -->
            <li>
              <a
                class="hutech-pagination-link"
                th:classappend="${page.last ? 'disabled' : ''}"
                th:href="@{''(page=${page.number + 1}, keyword=${keyword}, size=${page.size})}"
              >
                <i class="bi bi-chevron-right"></i>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </div>

    <!-- ==================== MODALS ==================== -->

    <!-- Confirm Delete Modal -->
    <div th:fragment="confirm-delete-modal(itemName)">
      <div
        class="modal fade"
        id="confirmDeleteModal"
        tabindex="-1"
        aria-labelledby="confirmDeleteModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content border-0 shadow-lg">
            <div class="modal-header border-0 pb-0">
              <h5 class="modal-title fw-bold" id="confirmDeleteModalLabel">
                <i class="bi bi-exclamation-triangle text-danger me-2"></i>
                Xác nhận xóa
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <p class="mb-0">
                Bạn có chắc chắn muốn xóa
                <strong th:text="${itemName}">mục này</strong>? Hành động này
                không thể hoàn tác.
              </p>
            </div>
            <div class="modal-footer border-0">
              <button
                type="button"
                class="hutech-btn hutech-btn-light"
                data-bs-dismiss="modal"
              >
                Hủy
              </button>
              <button
                type="button"
                class="hutech-btn hutech-btn-danger"
                id="confirmDeleteBtn"
              >
                <i class="bi bi-trash"></i> Xóa
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== ALERTS & MESSAGES ==================== -->

    <!-- Flash Messages -->
    <div th:fragment="flash-messages">
      <!-- Success Message -->
      <div
        th:if="${successMessage}"
        class="hutech-alert hutech-alert-success alert-dismissible fade show hutech-animate-slide-down"
        role="alert"
      >
        <div class="hutech-alert-icon">
          <i class="bi bi-check-circle-fill"></i>
        </div>
        <div class="hutech-alert-content">
          <div class="hutech-alert-title">Thành công!</div>
          <div th:text="${successMessage}"></div>
        </div>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>

      <!-- Error Message -->
      <div
        th:if="${errorMessage}"
        class="hutech-alert hutech-alert-danger alert-dismissible fade show hutech-animate-slide-down"
        role="alert"
      >
        <div class="hutech-alert-icon">
          <i class="bi bi-exclamation-circle-fill"></i>
        </div>
        <div class="hutech-alert-content">
          <div class="hutech-alert-title">Lỗi!</div>
          <div th:text="${errorMessage}"></div>
        </div>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>

      <!-- Warning Message -->
      <div
        th:if="${warningMessage}"
        class="hutech-alert hutech-alert-warning alert-dismissible fade show hutech-animate-slide-down"
        role="alert"
      >
        <div class="hutech-alert-icon">
          <i class="bi bi-exclamation-triangle-fill"></i>
        </div>
        <div class="hutech-alert-content">
          <div class="hutech-alert-title">Cảnh báo!</div>
          <div th:text="${warningMessage}"></div>
        </div>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>

      <!-- Info Message -->
      <div
        th:if="${infoMessage}"
        class="hutech-alert hutech-alert-info alert-dismissible fade show hutech-animate-slide-down"
        role="alert"
      >
        <div class="hutech-alert-icon">
          <i class="bi bi-info-circle-fill"></i>
        </div>
        <div class="hutech-alert-content">
          <div class="hutech-alert-title">Thông tin</div>
          <div th:text="${infoMessage}"></div>
        </div>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
    </div>

    <!-- ==================== LOADERS ==================== -->

    <!-- Loading Spinner -->
    <div th:fragment="loading-spinner(size)">
      <div class="text-center py-5">
        <div
          class="spinner-border hutech-text-primary"
          th:style="'width: ' + ${size != null ? size : '3rem'} + '; height: ' + ${size != null ? size : '3rem'}"
          role="status"
        >
          <span class="visually-hidden">Đang tải...</span>
        </div>
        <p class="mt-3 hutech-text-muted">Đang tải dữ liệu...</p>
      </div>
    </div>

    <!-- ==================== BREADCRUMBS ==================== -->

    <!-- Breadcrumb Navigation -->
    <nav th:fragment="breadcrumb(items)" aria-label="breadcrumb">
      <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item">
          <a href="/" class="text-decoration-none">
            <i class="bi bi-house-door"></i> Trang chủ
          </a>
        </li>
        <li
          th:each="item, iterStat : ${items}"
          class="breadcrumb-item"
          th:classappend="${iterStat.last ? 'active' : ''}"
        >
          <a
            th:if="${!iterStat.last}"
            th:href="${item.url}"
            th:text="${item.name}"
            class="text-decoration-none"
          >
            Item
          </a>
          <span th:if="${iterStat.last}" th:text="${item.name}">Current</span>
        </li>
      </ol>
    </nav>

    <!-- ==================== RATING ==================== -->

    <!-- Star Rating (Display Only) -->
    <div th:fragment="star-rating(rating)">
      <div class="d-flex align-items-center gap-1">
        <th:block th:each="i : ${#numbers.sequence(1, 5)}">
          <i
            th:class="${i <= rating ? 'bi bi-star-fill text-warning' : 'bi bi-star text-muted'}"
          ></i>
        </th:block>
        <span
          class="hutech-text-muted small ms-1"
          th:text="'(' + ${rating} + '/5)'"
        ></span>
      </div>
    </div>
  </body>
</html>
