<!doctype html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  lang="vi"
>
  <head th:replace="~{admin/layout-modern::admin-head(~{::title})}">
    <title>Dashboard - Admin HUTECH Bookstore</title>
  </head>
  <body>
    <div class="d-flex">
      <!-- Sidebar -->
      <nav th:replace="~{admin/layout-modern::sidebar('dashboard')}"></nav>

      <!-- Main Content -->
      <div class="hutech-main-content flex-grow-1">
        <!-- Top Bar -->
        <div
          th:replace="~{admin/layout-modern::topbar('Dashboard', 'Tổng quan hệ thống')}"
        ></div>

        <!-- Page Content -->
        <div class="hutech-content-wrapper">
          <!-- Flash Messages -->
          <div th:replace="~{admin/layout-modern::alerts}"></div>

          <!-- Stat Cards -->
          <div class="row g-4 mb-4">
            <!-- Total Books -->
            <div class="col-xl-3 col-md-6">
              <div class="hutech-stat-card">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="flex-grow-1">
                    <div class="hutech-stat-label">Tổng sách</div>
                    <div
                      class="hutech-stat-value"
                      th:text="${totalBooks != null ? totalBooks : 0}"
                    >
                      0
                    </div>
                    <div class="hutech-stat-change positive">
                      <i class="bi bi-arrow-up"></i>
                      <span>12%</span>
                      <span class="text-muted small">so với tháng trước</span>
                    </div>
                  </div>
                  <div
                    class="hutech-stat-icon"
                    style="color: var(--hutech-primary)"
                  >
                    <i class="bi bi-book-fill"></i>
                  </div>
                </div>
              </div>
            </div>

            <!-- Total Users -->
            <div class="col-xl-3 col-md-6">
              <div class="hutech-stat-card">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="flex-grow-1">
                    <div class="hutech-stat-label">Người dùng</div>
                    <div
                      class="hutech-stat-value"
                      th:text="${totalUsers != null ? totalUsers : 0}"
                    >
                      0
                    </div>
                    <div class="hutech-stat-change positive">
                      <i class="bi bi-arrow-up"></i>
                      <span>5%</span>
                      <span class="text-muted small">so với tháng trước</span>
                    </div>
                  </div>
                  <div
                    class="hutech-stat-icon"
                    style="color: var(--hutech-success)"
                  >
                    <i class="bi bi-people-fill"></i>
                  </div>
                </div>
              </div>
            </div>

            <!-- Total Orders -->
            <div class="col-xl-3 col-md-6">
              <div class="hutech-stat-card">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="flex-grow-1">
                    <div class="hutech-stat-label">Đơn hàng</div>
                    <div
                      class="hutech-stat-value"
                      th:text="${totalOrders != null ? totalOrders : 0}"
                    >
                      0
                    </div>
                    <div class="hutech-stat-change positive">
                      <i class="bi bi-arrow-up"></i>
                      <span>8%</span>
                      <span class="text-muted small">so với tháng trước</span>
                    </div>
                  </div>
                  <div
                    class="hutech-stat-icon"
                    style="color: var(--hutech-warning)"
                  >
                    <i class="bi bi-cart-check-fill"></i>
                  </div>
                </div>
              </div>
            </div>

            <!-- Total Revenue -->
            <div class="col-xl-3 col-md-6">
              <div class="hutech-stat-card">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="flex-grow-1">
                    <div class="hutech-stat-label">Doanh thu</div>
                    <div
                      class="hutech-stat-value"
                      th:text="${totalRevenue != null ? #numbers.formatDecimal(totalRevenue, 0, 'COMMA', 0, 'POINT') + '₫' : '0₫'}"
                    >
                      0₫
                    </div>
                    <div class="hutech-stat-change positive">
                      <i class="bi bi-arrow-up"></i>
                      <span>15%</span>
                      <span class="text-muted small">so với tháng trước</span>
                    </div>
                  </div>
                  <div
                    class="hutech-stat-icon"
                    style="color: var(--hutech-info)"
                  >
                    <i class="bi bi-cash-stack"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Charts Row -->
          <div class="row g-4 mb-4">
            <!-- Revenue Chart -->
            <div class="col-lg-8">
              <div class="hutech-card">
                <div class="hutech-card-header">
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <h5 class="fw-bold mb-0">
                      <i class="bi bi-graph-up hutech-text-primary"></i>
                      Doanh thu theo tháng
                    </h5>
                    <select
                      class="hutech-form-control hutech-form-control-sm"
                      style="width: auto"
                    >
                      <option>2024</option>
                      <option selected>2025</option>
                      <option>2026</option>
                    </select>
                  </div>
                </div>
                <div class="hutech-card-body">
                  <canvas id="revenueChart" height="80"></canvas>
                </div>
              </div>
            </div>

            <!-- Category Distribution -->
            <div class="col-lg-4">
              <div class="hutech-card">
                <div class="hutech-card-header">
                  <h5 class="fw-bold mb-0">
                    <i class="bi bi-pie-chart hutech-text-success"></i>
                    Sách theo danh mục
                  </h5>
                </div>
                <div class="hutech-card-body">
                  <canvas id="categoryChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="row g-4">
            <!-- Recent Orders -->
            <div class="col-lg-8">
              <div class="hutech-card">
                <div class="hutech-card-header">
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <h5 class="fw-bold mb-0">
                      <i class="bi bi-clock-history hutech-text-primary"></i>
                      Đơn hàng gần đây
                    </h5>
                    <a
                      th:href="@{/admin/orders}"
                      class="hutech-btn hutech-btn-sm hutech-btn-outline-primary"
                    >
                      Xem tất cả <i class="bi bi-arrow-right ms-1"></i>
                    </a>
                  </div>
                </div>
                <div class="hutech-card-body p-0">
                  <div class="table-responsive">
                    <table
                      class="hutech-table mb-0"
                      th:if="${recentOrders != null and !recentOrders.isEmpty()}"
                    >
                      <thead>
                        <tr>
                          <th>Mã ĐH</th>
                          <th>Khách hàng</th>
                          <th>Ngày đặt</th>
                          <th>Tổng tiền</th>
                          <th>Trạng thái</th>
                          <th>Thao tác</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr th:each="order : ${recentOrders}">
                          <td>
                            <strong th:text="'#' + ${order.id}">#123</strong>
                          </td>
                          <td
                            th:text="${order.user != null ? order.user.username : 'N/A'}"
                          >
                            User
                          </td>
                          <td
                            th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}"
                          >
                            01/01/2024
                          </td>
                          <td
                            class="hutech-text-primary fw-bold"
                            th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + '₫'"
                          >
                            100,000₫
                          </td>
                          <td>
                            <span
                              th:replace="~{components/ui-components::order-status-badge(${order.status})}"
                            ></span>
                          </td>
                          <td>
                            <a
                              th:href="@{/admin/orders/{id}(id=${order.id})}"
                              class="hutech-btn hutech-btn-sm hutech-btn-outline-primary"
                            >
                              <i class="bi bi-eye"></i>
                            </a>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <div
                      th:if="${recentOrders == null or recentOrders.isEmpty()}"
                      class="p-5"
                    >
                      <div
                        th:replace="~{components/ui-components::empty-state(
                                            'bi-cart-x', 
                                            'Chưa có đơn hàng nào', 
                                            'Chưa có đơn hàng nào được tạo',
                                            null,
                                            null
                                        )}"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quick Actions & Info -->
            <div class="col-lg-4">
              <!-- Quick Actions -->
              <div class="hutech-card mb-4">
                <div class="hutech-card-header">
                  <h5 class="fw-bold mb-0">
                    <i class="bi bi-lightning hutech-text-warning"></i>
                    Thao tác nhanh
                  </h5>
                </div>
                <div class="hutech-card-body">
                  <div class="d-grid gap-2">
                    <a
                      th:href="@{/admin/products/add}"
                      class="hutech-btn hutech-btn-primary"
                    >
                      <i class="bi bi-plus-circle"></i> Thêm sách mới
                    </a>
                    <a
                      th:href="@{/admin/categories/add}"
                      class="hutech-btn hutech-btn-success"
                    >
                      <i class="bi bi-folder-plus"></i> Thêm danh mục
                    </a>
                    <a
                      th:href="@{/admin/vouchers/add}"
                      class="hutech-btn hutech-btn-warning"
                    >
                      <i class="bi bi-ticket-perforated"></i> Tạo voucher
                    </a>
                    <a
                      th:href="@{/admin/reports}"
                      class="hutech-btn hutech-btn-info"
                    >
                      <i class="bi bi-file-earmark-bar-graph"></i> Xem báo cáo
                    </a>
                  </div>
                </div>
              </div>

              <!-- System Info -->
              <div class="hutech-card">
                <div class="hutech-card-header">
                  <h5 class="fw-bold mb-0">
                    <i class="bi bi-info-circle hutech-text-info"></i>
                    Thông tin hệ thống
                  </h5>
                </div>
                <div class="hutech-card-body">
                  <div class="d-flex flex-column gap-3">
                    <div class="d-flex justify-content-between">
                      <span class="hutech-text-muted">Phiên bản:</span>
                      <strong>2.0.0</strong>
                    </div>
                    <div class="d-flex justify-content-between">
                      <span class="hutech-text-muted">Database:</span>
                      <span class="hutech-badge hutech-badge-success"
                        >MySQL</span
                      >
                    </div>
                    <div class="d-flex justify-content-between">
                      <span class="hutech-text-muted">Server:</span>
                      <span class="hutech-badge hutech-badge-success"
                        >Online</span
                      >
                    </div>
                    <div class="d-flex justify-content-between">
                      <span class="hutech-text-muted">Cập nhật:</span>
                      <strong
                        th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy')}"
                      >
                        06/02/2026
                      </strong>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <div th:replace="~{admin/layout-modern::admin-scripts}"></div>

    <!-- Chart.js Initialization -->
    <script>
      // Revenue Chart
      const revenueCtx = document.getElementById("revenueChart");
      if (revenueCtx) {
        new Chart(revenueCtx, {
          type: "line",
          data: {
            labels: [
              "T1",
              "T2",
              "T3",
              "T4",
              "T5",
              "T6",
              "T7",
              "T8",
              "T9",
              "T10",
              "T11",
              "T12",
            ],
            datasets: [
              {
                label: "Doanh thu (triệu ₫)",
                data: [12, 19, 15, 25, 22, 30, 28, 35, 32, 38, 42, 45],
                borderColor: "rgb(13, 110, 253)",
                backgroundColor: "rgba(13, 110, 253, 0.1)",
                tension: 0.4,
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return value + "M";
                  },
                },
              },
            },
          },
        });
      }

      // Category Chart
      const categoryCtx = document.getElementById("categoryChart");
      if (categoryCtx) {
        new Chart(categoryCtx, {
          type: "doughnut",
          data: {
            labels: ["Công nghệ", "Kinh tế", "Văn học", "Khác"],
            datasets: [
              {
                data: [30, 25, 20, 25],
                backgroundColor: [
                  "rgb(13, 110, 253)",
                  "rgb(25, 135, 84)",
                  "rgb(255, 193, 7)",
                  "rgb(108, 117, 125)",
                ],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                position: "bottom",
              },
            },
          },
        });
      }
    </script>
  </body>
</html>
